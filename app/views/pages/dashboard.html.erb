<main>
  <div class="card-dashboard mb-3 mx-auto ">
    <div class="row align-items-start">
      <!-- Avatar + Username in Card Header-->
      <div class="col card-header d-flex justify-content-center align-items-center">
        <h1><%= image_tag("avatars/#{@user.avatar.to_s.downcase.presence || 'default'}.png", alt: "User avatar", style: "width:70px; height:70px; object-fit:cover; border-radius:50%;") %>
        <%= @user.username %>'s Achievements</h1>
      </div>
    </div>

    <div class="row align-items-start mb-3">
        <!-- Total Savings -->
        <div class="mb-1 text-center">
          <p class="mb-0"> ğŸ’° You have <strong><%= number_with_delimiter(@user.balance, delimiter: ",", separator: ".") %>$</strong> savings</p>
        </div>
        <div class="mb-1 text-center">
          <p class="mb-0"> âœğŸ½ You completed <%= @user.level.challenges.count %> challenges in level
          <% level_name = @user.level.name %>
          <% if level_name.include?("1") %>
            1
          <% elsif level_name.include?("2") %>
            2
          <% elsif level_name.include?("3") %>
            3
          <% else %>
            0
          <% end %>
        </p>
        </div>
        <!-- Decision-making Score -->
        <div class="mb-1 text-center">
          <p class="mb-0"> âœ… <%= @user.decision_score.to_i %>% of your choices were correct </p>
        </div>
    </div>

    <div class="row align-items-center mb-5">
      <!-- Level 1,2,3 Progress Bar -->
      <div data-controller="chart" class="col-md-11 d-flex flex-column justify-content-center align-items-center text-center">
          <div class="mb-4" style="width: 100%; max-width: 600px; height: 60px;">
            <canvas data-chart-target="level" data-level="1"
                    data-user-balance="<%= current_user.balance %>"
                    data-user-level="<%= current_user.level.name %>">
            </canvas>
          </div>

          <div class="mb-4" style="width: 100%; max-width: 600px; height: 60px;">
            <canvas data-chart-target="level" data-level="2"
                    data-user-balance="<%= current_user.balance %>"
                    data-user-level="<%= current_user.level.name %>">
            </canvas>
          </div>

          <div class="mb-4" style="width: 100%; max-width: 600px; height: 60px;">
            <canvas data-chart-target="level" data-level="3"
                    data-user-balance="<%= current_user.balance %>"
                    data-user-level="<%= current_user.level.name %>">
            </canvas>
          </div>
      </div>
      <!-- Right Column: Level Icons -->
      <div class="col-md-1 card-text d-flex flex-column align-items-end"
          data-controller="levels"
          data-levels-current-level-value="<%= current_user.level.name %>">

        <div class="level-icon mb-3 me-5" data-levels-target="icon" data-levels-level-value="1">
          <%= image_tag("icon_level1.png", alt: "Icon Level 1", style: "width:70px; height:70px; object-fit:cover; border-radius:50%;") %>
          <div class="overlay"></div>
        </div>

        <div class="level-icon mb-3 me-5" data-levels-target="icon" data-levels-level-value="2">
          <%= image_tag("icon_level2.png", alt: "Icon Level 2", style: "width:70px; height:70px; object-fit:cover; border-radius:50%;") %>
          <div class="overlay"></div>
        </div>

        <div class="level-icon mb-3 me-5" data-levels-target="icon" data-levels-level-value="3">
          <%= image_tag("icon_level3.png", alt: "Icon Level 3", style: "width:70px; height:70px; object-fit:cover; border-radius:50%;") %>
          <div class="overlay"></div>
        </div>
      </div>
    </div>
  </div>

  <!-- Continue Button -->
  <div class="text-center">
   <%= link_to "Continue Your Journey", pages_gameboard_path , class: "btn btn-primary btn-lg mt-3" %>
  </div>
</main>
